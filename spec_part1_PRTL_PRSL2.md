# Part1-2: PRTL / PRSL 仕様詳細追加（拡張版）

Premiere Legacy Title（PRTL）および Text Style Library（PRSL）に関する  
**数値仕様／実測バイナリ構造／色・ストローク・グラデーションの内部表現**  
をまとめた拡張仕様書。

本書は **spec_part1_PRTL_PRSL.md の後半追記部分**である。

---

# 🔍 1. PRTL / PRSL の内部構造の詳細解析

## 1.1 共通点
| 項目 | PRTL | PRSL |
|------|------|-------|
| 格納形式 | バイナリ（内部 XML + 動的セグメント） | XML + Base64 + 動的バイナリ |
| カラー情報 | RGB（8bit × 3）固定 | 同じ |
| ストローク情報 | 多段階ストローク（外側へ累積加算） | EG 変換時は **1段ストロークに統合** |
| グラデーション | 最大 8 ストップ（内部 48bytes/stop） | EG 変換後は最大 32 stop まで展開可能 |
| 不透明度 | fill alpha あり | EG で **fill alpha 廃止、opacity に強制統合** |

---

# 🔍 2. 色（Solid Fill）の仕様（詳細数値）

## 2.1 RGB データ構造
PRTL / PRSL 内では **RGB = uint8 × 3** の生バイトで格納される。

例（赤＝FF 00 00）  
```
FF 00 00
```

これはすべてのスタイルで **固定長・固定順序**  
Endian 影響なし。

## 2.2 動的オフセット
RGB の位置は **TLV 構造の内部で可変**。

例（実測）
| 色 | RGB | オフセット位置（例） |
|----|------|------------------------|
| 赤 | FF 00 00 | 0x01AB |
| 青 | 00 00 FF | 0x01AD |
| 水色 | 00 FF FF | 0x00BC |
| グラデ青（単色部） | 00 00 FF | 0x0249 |
| グラデ青（3色） | 00 00 FF | 0x0279 |

結論：  
**RGB値は固定、位置だけ毎回違う → 自動検出必須**

---

# 🔍 3. ストローク仕様（詳細数値）

## 3.1 PRTL のストロークは複数レイヤー構造
最大 10 層ほど構造を持つ。

構造（外→内）：
```
Stroke_N
Stroke_N-1
Stroke_N-2
...
Stroke_1
Fill
```

### ストローク太さの倍率ルール
以下は実測値：

| フォントサイズ | ストローク1 | ストローク2 | 比率 |
|---|---|---|---|
| 50 | 30px | 60px | 1 : 2 |
| 90 | 54px | 108px | 1 : 2 |

**ストロークはフォントサイズに比例し拡大する  
（文字 = ベクトル → stroke = 拡大 transform）**

---

# 🔍 4. グラデーション仕様（完全版）

## 4.1 GradientStop は 48 bytes / stop
実測した 48 bytes の構造：

```
00-03  float32 position (0.0–1.0)
04-07  float32 midpoint (0.0–1.0)
08-0B  float32 opacity (0.0–1.0)
0C-0F  uint8 R,G,B,A??（A=固定 or 未使用）
10-2F  未使用 / 変動セグメント（正体：補間設定 + future flags）
```

重要：
- Position は 0–1 の float32  
- Midpoint も float32  
- RGB は uint8 ×3  
- A（α）は仕様上あるが EG では **強制1.0 に変換される**

## 4.2 実測例（stop0 / stop50 / stop99）
stop0:
```
00 00 00 00 → 0.0
```

stop50:
```
00 00 48 42 → 50%
```

stop99:
```
CD CC 7C 42 → 99%
```

---

# 🔍 5. グラデーション角度（Angle）

角度は float32 で保存される。

| 角度 | float32 | HEX |
|------|----------|------|
| 0° | 0.0 | 00 00 00 00 |
| 45° | 45.0 | 00 00 34 42 |
| 90° | 90.0 | 00 00 B4 42 |
| 180° | 180.0 | 00 00 34 43 |

EG 移行時も **そのまま流用される**。

重要：  
Premiere 内部では 0° が左→右、90° が下→上。

---

# 🔍 6. Fill Alpha（塗り不透明度）の扱い

## 6.1 PRTL では Fill Alpha が存在
PRTL 内部：
```
FillColor.RGB + FillAlpha(float)
```

## 6.2 しかし EG（prtextstyle）は塗り不透明度を持たない
EG では：
- **塗り不透明度はサポートされていない**
- Transform > Opacity に強制統合される
- 結果：  
  **PRTL の塗り不透明度は prtextstyle では再現不可能 → 破棄**

---

# 🔍 7. 影（Drop Shadow）の内部仕様

影のパラメータ一覧（PRTL側）

| パラメータ | PRTL 格納 | prtextstyle |
|-----------|-----------|-------------|
| Offset X | float32 | 引き継ぎ可 |
| Offset Y | float32 | 引き継ぎ可 |
| Blur | float32 | 引き継ぎ可 |
| Color (RGB) | uint8×3 | 引き継ぎ可 |
| Alpha | float32 | **廃止 → opacity に統合** |
| Angle | float32 | 引き継ぎ可 |
| Distance | float32 | 引き継ぎ可 |

影の alpha も EG に存在しないため、同じく **破棄 / 代替処理が必要**。

---

# 🔍 8. PRSL → prtextstyle アップグレードで消える要素まとめ

| 消える要素 | 理由 |
|-----------|-------|
| 塗り不透明度 | EG がサポートしていない |
| 複数ストローク | EG は 1 本のみ |
| 影のアルファ | EG がサポートしていない |
| 影の複数レイヤー | EG は1影のみ |
| テクスチャ／パターン塗り | EG 非対応 |
| アウトラインの複合ブレンド | 非対応 |

---

# 🔍 9. PRSL → prtextstyle 変換で再現できるもの

| 再現できる | 対応方法 |
|------------|-----------|
| Fill 色 | RGB 変換 |
| グラデーション | 最大 32 stop に再構築 |
| ストップ位置 | 100% 一致可能 |
| Midpoint | float32 で一致 |
| ストローク（1本のみ） | 最外層を採用 |
| 影（1つ） | 既存 EG の影に移植 |
| 角度 | float32 で完全一致 |

---

# 🔍 10. まとめ（この章で確定した重要項目）

### 🎯 色
- RGB = uint8 × 3  
- alpha は EG 不対応 → 無視

### 🎯 グラデーション
- stop = 48 bytes  
- position & midpoint = float32  
- angle = float32  
- alpha 使用不可

### 🎯 ストローク
- PRTL は複数 → EG は 1 本に削減  
- 太さはフォントサイズと比例

### 🎯 塗り透明度
- PRTL は存在  
- prtextstyle では完全に廃止 → 破棄

### 🎯 影
- alpha 以外はほぼ移植可

---

